version: "3.9"

services:
  browser_a:
    image: browserless/chrome:latest
    environment:
      - MAX_CONCURRENT_SESSIONS=1
      - CONNECTION_TIMEOUT=600000
      - ENABLE_DEBUGGER=true
      - PREBOOT_CHROME=true
    ports:
      - "9223:3000"

  browser_b:
    image: browserless/chrome:latest
    environment:
      - MAX_CONCURRENT_SESSIONS=1
      - CONNECTION_TIMEOUT=600000
      - ENABLE_DEBUGGER=true
      - PREBOOT_CHROME=true
    ports:
      - "9224:3000"

  browser_c:
    image: browserless/chrome:latest
    environment:
      - MAX_CONCURRENT_SESSIONS=1
      - CONNECTION_TIMEOUT=600000
      - ENABLE_DEBUGGER=true
      - PREBOOT_CHROME=true
    ports:
      - "9225:3000"

  browser_api:
    build:
      context: .
      dockerfile: docker/Dockerfile.self_hosted_api
    environment:
      - BROWSER_ENDPOINTS_JSON={"a":"ws://browser_a:3000","b":"ws://browser_b:3000","c":"ws://browser_c:3000"}
      - BROWSER_USE_API_KEY=${BROWSER_USE_API_KEY:-}
    depends_on:
      - browser_a
      - browser_b
      - browser_c
    ports:
      - "8000:8000"

  browser_mcp:
    build:
      context: ../browser-use-api-mcp-server
    environment:
      - BROWSER_USE_API_KEY=${BROWSER_USE_API_KEY:-}
      - BROWSER_USE_API_BASE_URL=http://browser_api:8000/api/v2
      - MCP_HTTP_PORT=3000
      - MCP_HTTP_HOST=0.0.0.0
    depends_on:
      - browser_api
    ports:
      - "3000:3000"
